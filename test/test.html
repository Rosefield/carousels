<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Development Test</title>
    <script type="text/javascript" src="../dist/carousels.js"></script>
</head>
<body>
    <h2>Input Code</h2>
    <pre id="codePre">
        fn merge_sort_dedup&lt;T, P: Obliv>(a: &amp;[Possession&lt;T, P>])
        -> Vec&lt;Possession&lt;T, P>>
        where T: Ord + Clone
        {
            let n = a.len();
            if n > 1 {
                let m = n/2;
                merge_dedup(&merge_sort_dedup(&a[0..m]),
                            &merge_sort_dedup(&a[m..n]))
            } else {
                a.to_owned()
            }
        }

        fn merge_dedup&lt;T, P: Obliv>(a: &[Possession&lt;T, P>], b: &amp;[Possession&lt;T, P>])
        -> Vec&lt;Possession&lt;T, P>>
        where T: Ord + Clone
        { }
    </pre> <br/>

    <h2>Parsed as IR</h2>
    <pre id="irPre"></pre> <br/>

    <h2>Costs</h2>
    <pre id="costsPre"></pre> <br/>

    <hr style="width: 98%; margin-left: auto; margin-right: auto;"/> <br/>

    <h2>Result</h2>
    <h3>Parameters</h3>
    <pre id="parametersPre"></pre> <br/>

    <h3>Description</h3>
    <pre id="descriptionPre"></pre> <br/>

    <h3>Output</h3>
    <pre id="equationsPre" style="width: min-content; min-width: 90%;"></pre> <br/>

    <h3>Annotations + Code</h3>
    <div id="annotationPre"></div>
</body>
<script type="text/javascript">
  /* global document, carousels, JSON, console */
  document.addEventListener("DOMContentLoaded", async function () {
    await carousels.promise;

    // UI Elements
    const
      codePre = document.getElementById('codePre'),
      costsPre = document.getElementById('costsPre'),
      irPre = document.getElementById('irPre'),
      parametersPre = document.getElementById('parametersPre'),
      descriptionPre = document.getElementById('descriptionPre'),
      equationsPre = document.getElementById('equationsPre'),
      annotationPre = document.getElementById('annotationPre');

    // Analysis parameters
    const
      language = 'rust',
      code = codePre.textContent,
      costs = carousels.costs.rustBGW,
      metric = carousels.costs.rustBGW['metrics'][1]['title'],
      extraTyping = null;

    const IRCode = carousels.parsers.rust(code);
    irPre.textContent = JSON.stringify(IRCode, null, 2);
    costsPre.textContent = JSON.stringify(costs, null, 2);

    // function for analyzing
    const analyzer = new carousels.Analyzer(language, code, extraTyping);
    try {
      analyzer.analyze(costs, metric);
      const output = analyzer.symbolicResult();
      parametersPre.textContent = output.parameters.join('\n\n');
      descriptionPre.textContent = output.description.join('\n\n');
      equationsPre.textContent = output.equations.join('\n\n');
      console.log(output);
    } catch (err) {
      equationsPre.textContent = err.toString();
      console.log(err);
    }
    annotationPre.innerHTML = analyzer.prettyPrint();
  });
</script>
</html>